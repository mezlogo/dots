#!/bin/bash

pkgsList="$HOME/.config/pkgs.list"

actualPkgs() { comm -23 <(pacman -Qqe | sort) <(pacman -Qqg base base-devel | sort); }

diffPkgs() { comm -$1 -3 <(actualPkgs) $pkgsList ; } 

delete() { diffPkgs 2; }
install() { diffPkgs 1; }

case "$1" in
  import)
    [[ ! -z $(delete) ]] && sudo pacman -Rns $(delete) || echo nothing to delete
    [[ ! -z $(install) ]] && pacaur -S --needed $(install) || echo nothing to install
    ;;
  export) actualPkgs > $pkgsList ;;
  delete) echo "$(delete)" ;;
  install) install ;;
  *) echo "$(actualPkgs)" ;;
esac
